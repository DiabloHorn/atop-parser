# ATOP binary log parser for forensic purposes
This is a partial implementation of parsing ATOP binary log files with python. It uses the `dissect.cstruct` library which makes life worth living for if you want to work with C structures in python. The Dissect Target [ATOP plugin](https://github.com/fox-it/dissect.target/pull/108) was created based on this parser.

Feel free to add example data and update the code. Only reason this is licensed as AGPL is due to the original license of `dissect.cstruct`. Do let me know if it is NOT necessary to license this code as AGPL, since I'm not a big fan of this license.

Companion blog: https://diablohorn.com/2022/11/17/parsing-atop-files-with-python-dissect-cstruct/
# Examples
You run this with the assumption that you know the version that created the file. you can easily adapt the code to just guess the version number.

Command: 

`python atopdump.py 27 example_data/v2.7/atop_20221111` 

Output (line breaks for clarity only): 

`
{"rawheader": {"magic": 4276993775, "aversion": 33287, "future1": 0, "future2": 0, "rawheadlen": 480, "rawreclen": 96, "hertz": 100, "sfuture": [0, 0, 0, 0, 0, 0], "sstatlen": 954360, "tstatlen": 840, "utsname": {"sysname": "4c696e7578000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000", "nodename": "7372760000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000", "release": "352e31352e302d35322d67656e65726963000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000", "version": "2335382d5562756e747520534d5020546875204f63742031332030383a30343a353720555443203230323200000000000000000000000000000000000000000000", "machine": "6161726368363400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000", "domainname": "286e6f6e65290000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"}, "cfuture": "0000000000000000", "pagesize": 4096, "supportflags": 53, "osrel": 5, "osvers": 15, "ossub": 0, "ifuture": [0, 0, 0, 0, 0, 0]}} 

{"rawrecord": {"curtime": 1668196310, "flags": 49, "sfuture": [0, 0, 0], "scomplen": 1520, "pcomplen": 6786, "interval": 66, "ndeviat": 174, "nactproc": 134, "ntask": 174, "totproc": 134, "totrun": 2, "totslpi": 98, "totslpu": 65, "totzomb": 0, "nexit": 0, "noverflow": 0, "ifuture": [0, 0, 0, 0, 0, 0]}} 

{"tstat": {"gen": {"tgid": 1, "pid": 1, "ppid": 0, "ruid": 0, "euid": 0, "suid": 0, "fsuid": 0, "rgid": 0, "egid": 0, "sgid": 0, "fsgid": 0, "nthr": 1, "name": "systemd", "isproc": "01", "state": "53", "excode": -2147483648, "btime": 1668196244, "elaps": 0, "cmdline": "/sbin/init", "nthrslpi": 1, "nthrslpu": 0, "nthrrun": 0, "ctid": 0, "vpid": 0, "wasinactive": 0, "container": "00000000000000000000000000000000"}, "cpu": {"utime": 47, "stime": 42, "nice": 0, "prio": 120, "rtprio": 0, "policy": 0, "curcpu": 0, "sleepavg": 0, "ifuture": [0, 0, 0, 0], "wchan": "00000000000000000000000000000000", "rundelay": 46370214, "cfuture": [0]}, "dsk": {"rio": 321800, "rsz": 321800, "wio": 24048, "wsz": 24048, "cwsz": 9480, "cfuture": [0, 0, 0, 0]}, "mem": {"minflt": 19143, "majflt": 142, "vexec": 1428, "vmem": 167836, "rmem": 11324, "pmem": 4647, "vgrow": 167836, "rgrow": 11324, "vdata": 19804, "vstack": 1032, "vlibs": 12356, "vswap": 0, "vlock": 0, "cfuture": [0, 0, 0]}, "net": {"tcpsnd": 0, "tcpssz": 0, "tcprcv": 0, "tcprsz": 0, "udpsnd": 0, "udpssz": 0, "udprcv": 0, "udprsz": 0, "avail1": 0, "avail2": 0, "cfuture": [0, 0, 0, 0]}, "gpu": {"state": "00", "cfuture": "000000", "nrgpus": 0, "gpulist": 0, "gpubusy": 0, "membusy": 0, "timems": 0, "memnow": 0, "memcum": 0, "sample": 0}}} 

{"tstat": {"gen": {"tgid": 2908, "pid": 2908, "ppid": 1, "ruid": 0, "euid": 0, "suid": 0, "fsuid": 0, "rgid": 0, "egid": 0, "sgid": 0, "fsgid": 0, "nthr": 1, "name": "blkdeactivate", "isproc": "01", "state": "53", "excode": -2147483648, "btime": 1668200041, "elaps": 0, "cmdline": "/bin/bash /sbin/blkdeactivate -u -l wholevg -m disablequeueing -r wait", "nthrslpi": 1, "nthrslpu": 0, "nthrrun": 0, "ctid": 0, "vpid": 0, "wasinactive": 0, "container": "00000000000000000000000000000000"}, "cpu": {"utime": 0, "stime": 0, "nice": 0, "prio": 120, "rtprio": 0, "policy": 0, "curcpu": 2, "sleepavg": 0, "ifuture": [29440, 1946157178, 7995392, 29952], "wchan": "0000007600007a00007700007a000078", "rundelay": 274708, "cfuture": [82754194955567226]}, "dsk": {"rio": 32, "rsz": 32, "wio": 0, "wsz": 0, "cwsz": 0, "cfuture": [45598948273946785, 8791027172706908672, 134140429336576, 46724848180789413]}, "mem": {"minflt": 477, "majflt": 0, "vexec": 1332, "vmem": 7144, "rmem": 3584, "pmem": 1217, "vgrow": 7144, "rgrow": 3584, "vdata": 560, "vstack": 132, "vlibs": 1924, "vswap": 0, "vlock": 0, "cfuture": [134140430712832, 52635822691713210, 8791027280081091072]}, "net": {"tcpsnd": 0, "tcpssz": 0, "tcprcv": 0, "tcprsz": 0, "udpsnd": 0, "udpssz": 0, "udprcv": 0, "udprsz": 0, "avail1": 8791027331620698624, "avail2": 134140431761408, "cfuture": [57139422319083722, 8791027348800567808, 134140432023552, 4950018942480416974]}, "gpu": {"state": "00", "cfuture": "000000", "nrgpus": 18610, "gpulist": 7667712, "gpubusy": 440481792, "membusy": 100878338, "timems": 936750917276445952, "memnow": 3401888979026760, "memcum": 45880421490624520, "sample": 8863084771039804160}}}
`
